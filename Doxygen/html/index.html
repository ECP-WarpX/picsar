<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Picsar Doxygen Project: Picsar Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Picsar Doxygen Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Picsar Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Particle-In-Cell Scalable Application Resource (PICSAR) </h1>
<h2>1. Overview </h2>
<p>The PICSAR code is a "mini-app" standalone Particle-In-Cell (PIC) code that includes the key functionalities of the WARP code main PIC loop. It is a compact <b>self-contained proxy</b> that adequately portrays the computational loads and dataflow of the more complex WARP code.</p>
<p>Since WARP is a very large code written in a mix of FORTRAN95, C and Python PICSAR will be essential for studying multi-level parallelization on the next generation of exascale computers.</p>
<h4>A. Here are some of the specific algorithmic features of the PICSAR code :</h4>
<p>The Maxwell solver uses arbitrary order finite-difference scheme (staggered/centered), The particle pusher uses the Boris algorithm, The field gathering routine is energy conserving, The current deposition and field gathering routines include high order particle shape factors.</p>
<h4>B. Here are some high performance features of the PICSAR code :</h4>
<p>Particle tiling to help increase memory locality MPI parallelization for internode parallelism (blocking, non-blocking and Remote memory access MPI), OpenMP parallelization for intranode parallelism, MPI-IO for fast parallel outputs. Vectorized subroutines (field gathering, classical current deposition)</p>
<h4>C. Python glue:</h4>
<p>We created a Forthon parser that read Fortran source files of PICSAR and parse them to create a <code>picsar.v</code> file used by the Forthon compiler to generate a Python module for PICSAR. The Forthon parser is available in the folder <code>utils</code>. Thanks to Forthon, we are able to access all high performance routines of PICSAR from python. This allows us to use PICSAR routines from WARP and vice-versa.</p>
<h2>2. Compiling </h2>
<h4>A. Python installation</h4>
<p>In order to install picsar in the form of a Python module, read detailed instructions in the file <code>INSTALL_PYTHON.md</code></p>
<h4>B. Fortran installation</h4>
<p>To build the code in full Fotran 90 read instructions from the file <code>INSTALL_FORTRAN.md</code></p>
<h2>3. Running simulations </h2>
<h4>A. Python mode</h4>
<p>An example of python script <code>test.py</code> is provided in <code>example_scripts_python</code>. To run this script in parallel, simply type : </p><div class="fragment"><div class="line">mpirun -np NMPI python test.py </div></div><!-- fragment --><p> with NMPI the number of MPI processes.</p>
<h4>B. Fortran mode</h4>
<p>PICSAR input parameters must be provided in an input file named <code>input_file.pxr</code> in the folder where the code is ran. An example (<code>test.pxr</code>) of input file is provided in <code>example_decks_fortran/</code>. To run the executable on n MPI processes: </p><div class="fragment"><div class="line">mpirun -np n ./picsar</div></div><!-- fragment --><p> Notice that if <code>nprocx</code>, <code>nprocy</code> and <code>nprocz</code> are provided in the input file as part of the <code>cpusplit</code> section, then n must be equal to <code>nprocx x nprocy x nprocz</code> with <code>nprocx</code>, <code>nprocy</code>, <code>nprocz</code> the number of processors along x,y,z directions. Otherwise, if <code>nprocx</code>, <code>nprocy</code> and <code>nprocz</code> are not defined, the code performs automatic CPU split in each direction. User can specify some arguments in the command line. For the moments this feature supports only the number of tiles in each dimension and the init of particle distribution. Ex: <code>mpirun -np 1 ./picsar -ntilex ntx -ntiley nty -ntilez ntz -distr 1</code> with <code>ntx</code>, <code>nty</code> and <code>ntz</code> the number of tiles in each dimension (default is one) and distr the type of particle init ("1" for init on the x-axis of the grid and "2" for Random).</p>
<h4>C. OpenMP</h4>
<p>If the code (Fortran or python version) was compiled with OpenMP, you can set "x" OpenMP threads per MPI task by defining <code>export OMP_NUM_THREADS=x</code> before starting the simulation (default varies with the OS). OpenMP scheduling for balancing loads between tiles can be adjusted at runtime by setting the environment variable <code>OMP_SCHEDULE</code> to either <code>static</code>, <code>guided</code> or <code>dynamic</code>. To ensure that threads have enough memory space on the stack, set <code>OMP_STACKSIZE</code> to high enough value. In practice, <code>export OMP_STACKSIZE=32M</code> should be sufficient for most of test cases.</p>
<h2>4. Outputs </h2>
<h4>A. Field diagnostics</h4>
<p>For the moment, the code outputs binary matrix files with extensions ".pxr" that can be read using python scripts. Examples of such scripts are in the folder <code>postproc/</code>. In the Fortran version, the output frequency is controlled by setting the flag <code>output_frequency</code> in the output section of the <code>input_file.pixr</code>. Use <code>output_frequency=-1</code> to disable outputs. The code places output files in a <code>RESULTS</code> directory where the code is ran. This directory has to be created before running the code in your submission script.</p>
<h4>B. Temporal diagnostics</h4>
<p>Temporal diagnosctics enable to outpout the time evolution of several physical quantities such as the species kinetic energies, the field energies and the L2 norm of divergence of the field minus the charge. Temporal diagnostics can be configurated using the section <code>temporal</code>. Output format can be controled using the keyword <code>format</code>. Temporal output files can be binary files (<code>format=1</code>) or ascii files (<code>format=1</code>). The output frequency can be controled via the keyword <code>frequency</code>. The different diagnostics can be activated with their flags:</p>
<ul>
<li><code>kinE=1</code> for the kinetic energies</li>
<li><code>exE=1</code>, <code>eyE=1</code>, <code>ezE=1</code>: electric field energies</li>
<li><code>bxE=1</code>, <code>byE=1</code>, <code>bzE=1</code>: magnetic field energies</li>
<li><code>divE-rho=1</code>: the L2 norm of divergence of the field minus the charge</li>
</ul>
<h4>C. Time statistics</h4>
<p>Time statistics refer to the computation of the simulation times spend in each significant part of the code. A final time survey is automatically provided at the end of a simulation with the stand-alone code. The time statisctics function enables to outpout in files the time spend in the main subroutines for each iteration. It corresponds to the section named <code>timestat</code>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
