build:

  pre_ci_boot:
    image_name: rlehe/warp
    image_tag: latest
    pull: true

  ci:
    # Compile the unit tests
    - make build_test
    # Run the unit test
    - make test_gcov
    # Compile the Fortran kernel of Picsar
    - make clean
    - make
    # Add path to pythonpath
    - export PYTHONPATH="/home/warp_user/src/bitbucket.org/berkeleylab/picsar:$PYTHONPATH"
    # Run the tests for Picsar Fortran
    - cd Acceptance_testing/Fortran_tests/test_plasama_drift
    - py.test -s --ttest=1 --trun=1 --tshow=0
    - cd ../test_homogeneous_plasma
    - py.test -s --ttest=1 --trun=1 --tshow=0
    - cd ../test_Langmuir_wave
    - py.test -s --ttest=1 --trun=1 --tshow=0
    # Compile Picsar for Python
    - make -f Makefile_Forthon
    - make -f Makefile_Forthon test2
